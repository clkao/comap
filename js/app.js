function import$(t,e){var o={}.hasOwnProperty;for(var n in e)o.call(e,n)&&(t[n]=e[n]);return t}require.register("config.jsenv",function(t,e,o){o.exports={BUILD:"git-c3fddef"}}),angular.module("App",["app.templates","ngMaterial","ui.router","comap","leaflet-directive"]).config(["$stateProvider","$urlRouterProvider","$locationProvider"].concat(function(t,e,o){return t.state("about",{url:"/about",templateUrl:"app/partials/about.html",controller:"About"}).state("comap",{url:"/comap",templateUrl:"app/partials/comap.html",controller:"CoMapCtrl"}).state("comap.county",{url:"/{county}"}).state("comap.county.booth",{url:"/{seq}"}),e.otherwise("/comap/TPQ"),o.html5Mode(!0)})).run(["$rootScope","$state","$stateParams","$location","$window","$anchorScroll"].concat(function(t,e,o,n){return t.$state=e,t.$stateParam=o,t.config_build=require("config.jsenv").BUILD,t.$on("$stateChangeSuccess",function(t,e){var o;return o=e.name,"undefined"!=typeof window&&null!==window&&"function"==typeof window.ga?window.ga("send","pageview",{page:n.$$path,title:o}):void 0})})).controller({AppCtrl:["$scope","$location","$rootScope","$sce"].concat(function(t,e){return t.$location=e,t.$watch("$location.path()",function(e){return e||(e="/"),t.activeNavId=e,t}),t.getClass=function(e){return t.activeNavId.substring(0,e.length===e)?"active":""}})}).controller({About:["$rootScope","$http"].concat(function(t){return t.activeTab="about"})}),angular.module("config",[]).constant("API_ENDPOINT","http://api-beta.ly.g0v.tw:3908"),angular.module("comap",["config"]).factory({CoMapData:["$http","API_ENDPOINT"].concat(function(t,e){return{get:function(o){return t.get(e+"/collections/booth/"+o)},random:function(o,n){return t.get(e+"/collections/booth",{params:{q:JSON.stringify({lat:null}),f:JSON.stringify({id:!0}),l:1,sk:Math.round(Math.random()*n)}})},count:function(o,n){return t.get(e+"/collections/booth",{params:{q:n,c:1}})},set:function(o,n){return t.put(e+"/collections/booth/"+o,n)},geocode:function(e,o){var n,a,r;return n=o.city,a=null!=(r=o.country)?r:"TW",t.get("https://nominatim.openstreetmap.org/search",{params:import$({city:n,country:a},{format:"json",addressdetails:1,street:e})})}}})}).controller({CoMapCtrl:["$scope","$sce","$materialSidenav","$state","leafletData","CoMapData"].concat(function(t,e,o,n,a,r){var s;return t.countyName=s="新北市",t.$watch("$state.params.county",function(e){return e?r.count(e,JSON.stringify({lat:null})).success(function(o){return t.count=o.count,r.count(e).success(function(e){return t.total=e.count,"comap.county"===n.current.name?t.random():void 0})}):void 0}),t.$watch("$state.params.seq",function(e){return e?(t.id=n.params.county+"-"+n.params.seq,r.get(t.id).success(function(e){var o,n,a;return t.data=e,t.osmdata=(o=t.data.osm_data)?o:(a={},a.place_name=(n=t.data).place_name,a.address=n.address,a),(o=t.data.osm_id)?t.showOsm(o):void 0})):void 0}),t.toggleLeft=function(){return o("left").toggle()},import$(t,{center:{lat:24.5,lng:121.5,zoom:8}}),a.getMap().then(function(e){var o;return t.find=function(){return r.geocode(t.osmdata.place_name,{city:s}).success(function(e){return t.osmdata.nameResults=e}),r.geocode(t.osmdata.address,{city:s}).success(function(e){return t.osmdata.addressResults=e}),t.data.street?r.geocode(t.osmdata.street,{city:s}).success(function(e){return t.osmdata.streetResults=e}):void 0},t.edit=function(t){var e;return e="https://www.openstreetmap.org/edit?"+t.osm_type+"="+t.osm_id,window.open(e,"_blank")},t.setPlace=function(e){var o;return import$((o=t.data,o.place_id=e.place_id,o),{osm_id:e.osm_type+"/"+e.osm_id,lat:e.lat,lng:e.lon,osm_name:$('tag[k="name"]',t.xml).attr("v")}),t.showOsm(t.data.osm_id,function(){return t.dirty=!0,t.selectingName=!1})},t.selectName=function(){return t.osmdata.nameResults||r.geocode(t.osmdata.place_name,{city:s}).success(function(e){return t.osmdata.nameResults=e}),t.selectingName=!0},t.selectAddress=function(){return t.osmdata.addressResults||r.geocode(t.osmdata.address,{city:s}).success(function(e){return t.osmdata.addressResults=e}),t.selectingAddress=!0},t.setStreet=function(e){return import$(t.data,{osm_street_id:e.osm_type+"/"+e.osm_id}),t.showOsm(t.data.osm_street_id,function(){return t.dirty=!0,t.selectingAddress=!1})},t.save=function(){var e;return t.data.osm_data=t.osmdata,r.set(t.id,{osm_data:(e=t.data).osm_data,place_id:e.place_id,osm_id:e.osm_id,osm_name:e.osm_name,lat:e.lat,lng:e.lng,osm_street_id:e.osm_street_id}).success(function(){return t.dirty=!1,t.random()})},t.random=function(){return r.random(t.county,t.count).success(function(e){var o,a,r;return t.count=e.paging.count,o=e.entries[0].id.split("-"),a=o[0],r=o[1],n.transitionTo("comap.county.booth",{county:n.params.county,seq:r})})},t.showOsm=function(n,a){var r;return r=/node/.exec(n)?"":"/full",$.ajax({url:"https://www.openstreetmap.org/api/0.6/"+n+r,dataType:"xml",success:function(n){var r,s;return t.xml=n,"function"==typeof a&&a(),(r=o)&&e.removeLayer(r),s=new L.OSM.DataLayer(n),e.fitBounds(s.getBounds()),setTimeout(function(){return s.addTo(e),o=s},200)}})},t.look=function(e){return t.showOsm([e.osm_type,e.osm_id].join("/"))}})})}).controller({LeftCtrl:["$scope","$timeout","$materialSidenav"].concat(function(t,e,o){return t.close=function(){return o("left").close()}})}).controller({RightCtrl:["$scope","$timeout","$materialSidenav"].concat(function(t,e,o){return t.close=function(){return o("right").close()}})});