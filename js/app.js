function import$(t,o){var n={}.hasOwnProperty;for(var e in o)n.call(o,e)&&(t[e]=o[e]);return t}require.register("config.jsenv",function(t,o,n){n.exports={BUILD:"git-4e07f1e"}}),angular.module("App",["app.templates","ngMaterial","ui.router","comap","leaflet-directive"]).config(["$stateProvider","$urlRouterProvider","$locationProvider"].concat(function(t,o,n){return t.state("about",{url:"/about",templateUrl:"app/partials/about.html",controller:"About"}).state("comap",{url:"/comap",templateUrl:"app/partials/comap.html",controller:"CoMapCtrl"}).state("comap.county",{url:"/{county}"}).state("comap.county.booth",{url:"/{seq}"}),o.otherwise("/comap/TPQ"),n.html5Mode(!0)})).run(["$rootScope","$state","$stateParams","$location","$window","$anchorScroll"].concat(function(t,o,n,e){return t.$state=o,t.$stateParam=n,t.config_build=require("config.jsenv").BUILD,t.$on("$stateChangeSuccess",function(t,o){var n;return n=o.name,"undefined"!=typeof window&&null!==window&&"function"==typeof window.ga?window.ga("send","pageview",{page:e.$$path,title:n}):void 0})})).controller({AppCtrl:["$scope","$location","$rootScope","$sce","CoMapData"].concat(function(t,o,n,e,a){return t.$location=o,t.$watch("$location.path()",function(o){return o||(o="/"),t.activeNavId=o,t}),t.getClass=function(o){return t.activeNavId.substring(0,o.length===o)?"active":""},a.completion(JSON.stringify({lat:null})).success(function(o){var n;return null!=o&&(n=o.entries),t.cities=n})})});var tw3166;tw3166={CHA:"彰化縣",CYI:"嘉義市",CYQ:"嘉義縣",HSQ:"新竹縣",HSZ:"新竹市",HUA:"花蓮縣",ILA:"宜蘭縣",JME:"金門縣",KEE:"基隆市",KHH:"高雄市",LJF:"連江縣",MIA:"苗栗縣",NAN:"南投縣",PEN:"澎湖縣",PIF:"屏東縣",TAO:"桃園市",TNN:"臺南市",TPE:"臺北市",TPQ:"新北市",TTT:"臺東縣",TXG:"臺中市",YUN:"雲林縣"},angular.module("comap",["config"]).factory({CoMapData:["$http","API_ENDPOINT"].concat(function(t,o){return{get:function(n){return t.get(o+"/collections/booth/"+n)},set:function(n,e){return t.put(o+"/collections/booth/"+n,e)},list:function(n,e,a){return null==e&&(e=30),null==a&&(a=0),t.get(o+"/collections/booth",{params:{q:JSON.stringify({county:n}),l:e,sk:a}})},random:function(n,e){return t.get(o+"/collections/booth",{params:{q:JSON.stringify({county:n,lat:null}),f:JSON.stringify({id:!0}),l:1,sk:Math.round(Math.random()*e)}})},count:function(n,e){return null==e&&(e={}),t.get(o+"/collections/booth",{params:{q:JSON.stringify(import$({county:n},e)),c:1}})},completion:function(){return t.get(o+"/collections/completion")},geocode:function(o){var n,e,a,r,c,s,u;return n=o.q,e=o.house_number,a=o.street,r=o.city,c=null!=(s=o.country)?s:"TW",u=o.county,"桃園市"===r&&(r="桃園縣 (Táoyuán)"),t.get("https://nominatim.openstreetmap.org/search",{params:import$({county:u,city:r,country:c},{format:"json",addressdetails:1,street:e+" "+a,q:n})})}}})}).controller({CoMapCtrl:["$q","$scope","$sce","$state","leafletData","CoMapData"].concat(function(t,o,n,e,a,r){var c;return c=t.defer(),o.$watch("$state.params.county",function(t){return t?(o.county=t,r.count(t).success(function(t){return o.count=t.count,o.random(),o.nextList()})):e.params.county="TPE"}),import$(o,{center:{lat:25.04,lng:121.54,zoom:13}}),a.getMap().then(function(t){var n;return o.match=function(t){return import$(o.data,{osm_id:t.osm_id,lat:t.lat,lng:t.lon})},o.search=function(){return o.osmdata.searchResults=[],r.geocode({city:tw3166[o.county],county:o.data.town,q:o.osmdata.place_name}).success(function(t){var n;return(n=o.osmdata).searchResults=n.searchResults.concat(t)}),r.geocode({city:tw3166[o.county],county:o.data.town,house_number:o.osmdata.house_number,street:o.osmdata.address}).success(function(t){var n;return(n=o.osmdata).searchResults=n.searchResults.concat(t)})},o.save=function(){var t;return o.data.osm_data=o.osmdata,r.set(o.id,{osm_data:(t=o.data).osm_data,place_id:t.place_id,osm_id:t.osm_id,osm_name:t.osm_name,lat:t.lat,lng:t.lng,osm_street_id:t.osm_street_id}).success(function(){return o.dirty=!1,o.random()})},o.random=function(){return r.random(o.county,o.count).success(function(t){var o,n,a;return o=t.entries[0].id.split("-"),n=o[0],a=o[1],e.transitionTo("comap.county.booth",{county:e.params.county,seq:a})})},o.offset=0,o.prevList=function(){return r.list(o.county,10,o.offset-=10).success(function(t){return o.booths=t.entries})},o.nextList=function(){return r.list(o.county,10,o.offset+=10).success(function(t){return o.booths=t.entries})},o.showOsm=function(e,a){var r;return r=/node/.exec(e)?"":"/full",$.ajax({url:"https://www.openstreetmap.org/api/0.6/"+e+r,dataType:"xml",success:function(e){var r,c;return o.xml=e,"function"==typeof a&&a(),(r=n)&&t.removeLayer(r),c=new L.OSM.DataLayer(e),t.fitBounds(c.getBounds()),setTimeout(function(){return c.addTo(t),n=c},200)}})},o.look=function(t){return o.showOsm([t.osm_type,t.osm_id].join("/"))},o.searchResultsFilter=function(t){return o.data.osm_id?o.data.osm_id===t.osm_id?(o.look(t),!0):!1:!0},o.$watch("$state.params.seq",function(t){return void 0!==t?t?(o.id=e.params.county+"-"+e.params.seq,r.get(o.id).success(function(t){var n,e,a;return o.data=t,o.osmdata=(n=o.data.osm_data)?n:(a={},a.place_name=(e=o.data).place_name,a.address=e.address,a)})):c.promise.then(function(){return o.random()}):void 0})})})}).filter("countyName",function(){return function(t){return tw3166[t]}}),angular.module("comap").controller({About:["$rootScope","$http"].concat(function(t){return t.activeTab="about"})}),angular.module("comap").controller({ListCtrl:["$q","$scope"].concat(function(t,o){return o})}),angular.module("config",[]).constant("API_ENDPOINT","http://api-beta.ly.g0v.tw:3908");